# NKU Wiki 微信小程序 - 代码文件索引

## 项目概述

这是一个基于 Taro 框架开发的微信小程序，名为 NKU Wiki，是一个校园社交和知识分享平台。项目采用 React + TypeScript + Redux 技术栈，支持帖子发布、AI 聊天、用户互动等功能。

## 目录结构与文件功能分析

### 📱 应用入口文件

#### `src/app.tsx`
- **功能**: 应用主入口组件
- **场景**: 应用启动时的初始化逻辑
- **主要功能**:
  - Redux Provider 配置
  - 用户登录状态检查
  - 自动注入开发环境 Token
  - AbortController polyfill 兼容性处理
  - 导航栏状态同步初始化

#### `src/app.config.ts`
- **功能**: 小程序全局配置
- **场景**: 定义页面路由、分包、窗口样式、底部导航栏
- **主要配置**:
  - 主包页面: home, explore, discover, profile
  - 分包1 (subpackage-profile): 用户相关页面
  - 分包2 (subpackage-interactive): 互动功能页面
  - 自定义 tabBar 配置

#### `src/app.scss`
- **功能**: 全局样式文件
- **场景**: 定义全局 CSS 变量、通用样式、盒模型规范
- **主要内容**:
  - 引入 Taro UI 样式
  - 全局字体和背景色设置
  - 通用容器样式

### 🏠 主要页面 (Main Pages)

#### `src/pages/home/index.tsx`
- **对应页面**: 首页 (Home)
- **功能**: 信息流展示和内容分类浏览
- **主要特性**:
  - 帖子信息流展示
  - 分类筛选 (学习交流、校园生活、就业创业、社团活动、失物招领)
  - 下拉刷新和上拉加载更多
  - 搜索功能入口
  - 骨架屏加载状态

#### `src/pages/explore/index.tsx`
- **对应页面**: 探索页 (Explore)
- **功能**: AI 智能搜索和知识问答
- **主要特性**:
  - 多模式搜索 (@wiki, @user, @post, @knowledge)
  - RAG 智能问答功能
  - 热门搜索推荐
  - 动态搜索建议
  - 内容上传功能
  - 瀑布流内容展示

#### `src/pages/discover/index.tsx`
- **对应页面**: 发现页 (Discover)
- **功能**: 热门内容推荐和校园资源聚合
- **主要特性**:
  - 热门帖子推荐
  - AI 推荐算法切换
  - 校园活动展示
  - 学习资源聚合
  - AI 助手入口
  - 下拉刷新功能

#### `src/pages/profile/index.tsx`
- **对应页面**: 个人中心 (Profile)
- **功能**: 用户信息展示和个人功能入口
- **主要特性**:
  - 用户基本信息展示
  - 登录/注册引导
  - 个人统计数据 (关注、粉丝、收藏、点赞)
  - 个人功能入口 (编辑资料、设置、草稿箱等)
  - 退出登录功能

### 📦 分包页面 (Subpackages)

#### 互动功能分包 (`subpackage-interactive`)

##### `src/pages/subpackage-interactive/chat/index.tsx`
- **对应页面**: AI 聊天页面
- **功能**: 与 AI 助手进行对话交流
- **主要特性**:
  - 实时消息流显示
  - 流式响应处理
  - 参考资料展示
  - 知识库搜索状态
  - 聊天会话管理
  - 侧边栏功能

##### `src/pages/subpackage-interactive/publish/index.tsx`
- **对应页面**: 发布帖子页面
- **功能**: 创建和发布新帖子
- **主要特性**:
  - 富文本编辑器
  - 图片上传和管理
  - 标签选择和自定义
  - 分类选择
  - AI 内容润色建议
  - 草稿保存和恢复
  - 发布设置 (公开性、评论权限)

##### `src/pages/subpackage-interactive/post-detail/index.tsx`
- **对应页面**: 帖子详情页面
- **功能**: 查看帖子详细内容和互动

##### `src/pages/subpackage-interactive/notification/index.tsx`
- **对应页面**: 消息通知页面
- **功能**: 查看点赞、评论、关注等通知

#### 用户功能分包 (`subpackage-profile`)

##### `src/pages/subpackage-profile/login/index.tsx`
- **对应页面**: 登录注册页面
- **功能**: 用户身份验证
- **主要特性**:
  - 微信登录集成
  - 手机号登录 (预留)
  - 第三方登录入口 (QQ)
  - 登录状态管理

##### 其他用户功能页面
- `edit-profile/index.tsx`: 编辑个人资料
- `settings/index.tsx`: 应用设置
- `draft-box/index.tsx`: 草稿箱管理
- `collection/index.tsx`: 收藏内容
- `followers/index.tsx`: 关注和粉丝
- `likes/index.tsx`: 点赞记录
- `comments/index.tsx`: 评论记录
- `history/index.tsx`: 浏览历史
- `feedback/index.tsx`: 意见反馈
- `my-posts/index.tsx`: 我的帖子
- `about/index.tsx`: 关于页面
- `level/index.tsx`: 用户等级

### 🧩 组件库 (Components)

#### `src/components/custom-header/index.tsx`
- **功能**: 自定义导航栏组件
- **使用场景**: 所有需要自定义导航栏的页面
- **特性**:
  - 适配不同设备的状态栏高度
  - 支持返回按钮、标题、右侧操作
  - 响应式布局
  - 安全区域适配

#### `src/custom-tab-bar/index.tsx`
- **功能**: 自定义底部导航栏
- **使用场景**: 主要页面的底部导航
- **特性**:
  - 动态选中状态同步
  - 登录状态检查
  - 发布按钮特殊处理
  - 图标状态切换

#### 其他通用组件
- `badge/index.tsx`: 徽章组件
- `button/index.tsx`: 按钮组件
- `card/index.tsx`: 卡片组件
- `post/index.tsx`: 帖子展示组件
- `post-item-skeleton/index.tsx`: 帖子骨架屏
- `empty-state/index.tsx`: 空状态组件
- `categories/index.tsx`: 分类选择组件
- `about-icons/index.tsx`: 关于页面图标组件

### 🔧 服务层 (Services)

#### `src/services/request.ts`
- **功能**: HTTP 请求封装
- **场景**: 所有 API 调用的基础
- **特性**:
  - 请求拦截器配置
  - 自动 Token 注入
  - 错误处理和提示
  - 加载状态管理
  - 响应数据标准化

#### API 服务模块 (`src/services/api/`)
- `post.ts`: 帖子相关 API
- `user.ts`: 用户相关 API
- `auth.ts`: 认证相关 API
- `comment.ts`: 评论相关 API
- `upload.ts`: 文件上传 API
- `agent.ts`: AI 助手 API
- `knowledge.ts`: 知识库 API
- `recommend.ts`: 推荐算法 API
- `feedback.ts`: 反馈相关 API
- `notification.ts`: 通知相关 API
- `collection.ts`: 收藏相关 API
- `followers.ts`: 关注关系 API
- `level.ts`: 用户等级 API
- `about.ts`: 关于信息 API
- `action.ts`: 用户行为 API

### 🗄️ 状态管理 (Store)

#### `src/store/index.ts`
- **功能**: Redux Store 配置
- **特性**:
  - Redux Toolkit 集成
  - 数据持久化配置
  - 中间件配置

#### Redux Slices (`src/store/slices/`)
- `userSlice.ts`: 用户状态管理
- `postSlice.ts`: 帖子状态管理
- `chatSlice.ts`: 聊天状态管理
- `likeSlice.ts`: 点赞状态管理
- `actionSlice.ts`: 用户行为状态
- `aboutSlice.ts`: 关于信息状态
- `levelSlice.ts`: 用户等级状态

### 🎨 样式和资源 (Styles & Assets)

#### `src/styles/`
- `variables.scss`: SCSS 变量定义
- `taro-ui-custom.scss`: Taro UI 自定义样式

#### `src/assets/`
包含所有静态资源文件:
- **图标**: SVG 格式的功能图标 (arrow-left, search, heart 等)
- **图片**: PNG/JPG 格式的图片资源 (logo, avatar, placeholder 等)
- **导航图标**: 底部导航栏的激活/非激活状态图标

### 🔧 工具函数 (Utils)

#### `src/utils/tabBarSync.ts`
- **功能**: 底部导航栏状态同步
- **场景**: 确保自定义 tabBar 与页面状态一致
- **特性**:
  - 全局状态管理
  - 监听器模式
  - 页面路径匹配

#### 其他工具模块
- `colors.ts`: 颜色工具函数
- `draft.ts`: 草稿管理工具
- `history.ts`: 历史记录工具
- `image.ts`: 图片处理工具
- `storage.ts`: 本地存储工具
- `time.ts`: 时间处理工具
- `ui.ts`: UI 相关工具
- `persistStorage.ts`: 持久化存储工具

### 📝 类型定义 (Types)

#### `src/types/api/`
- `post.d.ts`: 帖子相关类型定义
- `user.ts`: 用户相关类型定义
- `auth.d.ts`: 认证相关类型定义
- `comment.d.ts`: 评论相关类型定义
- `common.d.ts`: 通用类型定义
- `agent.d.ts`: AI 助手类型定义
- `knowledge.d.ts`: 知识库类型定义
- `recommend.d.ts`: 推荐算法类型定义
- 其他业务模块类型定义...

#### 其他类型文件
- `chat.d.ts`: 聊天功能类型
- `draft.d.ts`: 草稿功能类型
- `history.d.ts`: 历史记录类型
- `about.d.ts`: 关于信息类型

### 🎯 常量定义 (Constants)

#### `src/constants/colors.ts`
- **功能**: 颜色常量集中管理
- **场景**: 避免硬编码颜色值
- **分类**:
  - 主题色 (THEME_COLORS)
  - 状态色 (STATUS_COLORS)
  - 背景色 (BACKGROUND_COLORS)
  - 文字色 (TEXT_COLORS)
  - 边框色 (BORDER_COLORS)

#### `src/constants/index.ts`
- **功能**: 其他常量定义
- **内容**: API 配置、错误码、默认值等

### 🔗 自定义 Hooks

#### `src/hooks/useAuthGuard.ts`
- **功能**: 登录状态检查 Hook
- **使用场景**: 需要登录才能访问的功能
- **特性**:
  - 自动登录检查
  - 未登录时跳转引导
  - 权限控制

## 技术架构特点

### 🏗️ 架构设计
1. **分层架构**: 页面层 → 组件层 → 服务层 → 工具层
2. **模块化**: 按功能模块划分，便于维护和扩展
3. **类型安全**: 全面使用 TypeScript，提供完整的类型定义
4. **状态管理**: 使用 Redux Toolkit 进行全局状态管理
5. **样式管理**: CSS Modules + SCSS 变量，避免样式冲突

### 🚀 性能优化
1. **分包加载**: 按功能模块分包，减少主包体积
2. **懒加载**: 非核心功能按需加载
3. **骨架屏**: 提升用户体验的加载状态
4. **图片优化**: 统一的图片处理和压缩
5. **缓存策略**: 合理的数据缓存和持久化

### 🔒 安全特性
1. **Token 管理**: 自动 Token 注入和刷新
2. **权限控制**: 基于登录状态的功能访问控制
3. **数据验证**: 完整的类型检查和数据验证
4. **错误处理**: 统一的错误处理和用户提示

### 🎨 用户体验
1. **响应式设计**: 适配不同设备和屏幕尺寸
2. **交互反馈**: 丰富的加载状态和操作反馈
3. **无障碍访问**: 考虑可访问性的设计
4. **流畅动画**: 合理的过渡动画和交互效果

## 开发规范

### 📁 文件命名
- 页面文件: `index.tsx` + `index.config.ts` + `index.module.scss`
- 组件文件: `PascalCase` 或 `index.tsx`
- 工具文件: `camelCase.ts`
- 类型文件: `moduleName.d.ts`

### 🎯 代码组织
- 单一职责: 每个文件/函数只负责一个功能
- 模块化: 相关功能组织在同一模块内
- 可复用: 通用功能抽象为组件或工具函数
- 可测试: 便于单元测试的代码结构

### 📋 注释规范
- 文件头部: 说明文件功能和使用场景
- 函数注释: 参数、返回值、功能说明
- 复杂逻辑: 关键算法和业务逻辑的解释
- TODO 标记: 待完成功能的标记

---

*本文档记录了 NKU Wiki 微信小程序的完整代码结构和功能说明，便于开发团队理解和维护项目。*