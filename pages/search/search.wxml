<!-- 美化的搜索页面 -->
<view class="page-container">
	<view class="search-container">
		<view class="search-box" hover-class="search-box-hover">
			<image class="search-icon" src="/assets/icons/index/plus.png" mode="aspectFit" bindtap="uploadFile" />
			<input
				class="search-input"
				placeholder="探索关于南开的一切，或者贡献您的资料"
				placeholder-style="color: #999;"
				value="{{ searchValue }}"
				bindinput="onInputChange"
				bindconfirm="handleSearch"
				focus="{{ false }}"
			/>
			<image class="mic-icon" src="/assets/icons/search/voice.png" mode="aspectFit" bindtap="startVoiceSearch" />
		</view>
		<!-- 分类按钮区域 -->
		<view class="category-buttons">
			<view class="category-item">
				<image class="category-icon" src="/assets/icons/search/website.png" mode="aspectFit" />
				<text class="category-text">网站</text>
			</view>
			<view class="category-item">
				<image class="category-icon" src="/assets/icons/search/wechat.png" mode="aspectFit" />
				<text class="category-text">微信</text>
			</view>
			<view class="category-item">
				<image class="category-icon" src="/assets/icons/search/market.png" mode="aspectFit" />
				<text class="category-text">集市</text>
			</view>
			<view class="category-item">
				<image class="category-icon" src="/assets/icons/search/douyin.png" mode="aspectFit" />
				<text class="category-text">抖音</text>
			</view>
		</view>
		<!-- 贡献提示区域 -->
		<view class="contribution-tip">
			<image class="token-icon" src="/assets/icons/search/token.png" mode="aspectFit" />
			<text class="tip-text">今日您已贡献了10条知识，获取1000token!</text>
		</view>
	</view>
	<!-- 结果区域 -->
	<view class="content-area">
		<!-- 加载指示器 - 只在loading为true且没有文本内容也不是流式状态时显示 -->
		<view class="loading-wrapper" wx:if="{{ loading && !textContent && !isStreaming }}">
			<view class="loading-dots">
				<view class="loading-dot"></view>
				<view class="loading-dot"></view>
				<view class="loading-dot"></view>
			</view>
			<text class="loading-text">南开小知正在思考</text>
		</view>
		<!-- 流式响应结果 -->
		<view class="result-container" wx:if="{{ textContent || isStreaming }}">
			<!-- 纯文本内容 -->
			<scroll-view scroll-y class="text-content" wx:if="{{ usePlainText }}">
				<text selectable="true">{{ textContent }}</text>
				<view wx:if="{{ isStreaming }}" class="typing-cursor"></view>
			</scroll-view>
			<!-- 美化的富文本内容 -->
			<scroll-view scroll-y class="text-content" wx:else>
				<rich-text nodes="{{ markdownHtml }}" wx:if="{{ markdownHtml }}"></rich-text>
				<towxml nodes="{{ richTextContent }}" wx:elif="{{ richTextContent }}" />
				<view wx:if="{{ isStreaming }}" class="typing-cursor"></view>
			</scroll-view>
			<!-- 底部操作按钮 -->
			<view class="result-actions">
				<view class="action-btn" hover-class="action-btn-hover" bindtap="clearResult">
					<image class="action-icon" src="/assets/icons/eraser.png" mode="aspectFit" />
					<text>清空</text>
				</view>
				<view class="action-btn" hover-class="action-btn-hover" bindtap="copyResult">
					<image class="action-icon" src="/assets/icons/copy.png" mode="aspectFit" />
					<text>复制内容</text>
				</view>
				<view class="action-btn" hover-class="action-btn-hover" bindtap="togglePlainTextMode">
					<image class="action-icon" src="/assets/icons/txt.png" mode="aspectFit" />
					<text>{{ usePlainText ? '富文本模式' : '纯文本模式' }}</text>
				</view>
			</view>
			
			<!-- 建议问题区域 -->
			<view class="suggested-questions" wx:if="{{ suggestedQuestions && suggestedQuestions.length > 0 }}">
				<view class="suggest-title">相关提问：</view>
				<view class="question-list">
					<view 
						class="question-item" 
						wx:for="{{ suggestedQuestions }}" 
						wx:key="index" 
						bindtap="handleRecommendClick" 
						data-question="{{ item }}">
						{{ item }}
					</view>
				</view>
			</view>
			
			<!-- 搜索来源 -->
			<view class="sources-container" wx:if="{{ sources && sources.length > 0 }}">
				<view class="sources-title">参考来源：</view>
				<view class="sources-list">
					<view class="source-item" wx:for="{{ sources }}" wx:key="index">
						<view class="source-content">
							<view class="source-type" wx:if="{{ item.type }}">{{ item.type }}</view>
							<view class="source-title" wx:if="{{ item.title }}">{{ item.title }}</view>
							<view class="source-preview" wx:if="{{ item.content }}">{{ item.content }}</view>
							<view class="source-author" wx:if="{{ item.author }}">— {{ item.author }}</view>
						</view>
					</view>
				</view>
			</view>
		</view>
		<!-- 默认提示 -->
		<view class="empty-state" wx:if="{{ !loading && !textContent && !isStreaming }}">
			<image class="empty-icon" src="/assets/icons/search/search.png" mode="aspectFit" />
			<text class="empty-text">有问题随时探索</text>
			<text class="empty-sub-text">南开百科随时为您解答</text>
		</view>
	</view>
</view>