<view class="comment-item" wx:if="{{formattedComment}}">
  <view class="comment-header">
    <view class="user-info" bindtap="onTapUser">
      <image class="avatar" src="{{formattedComment.avatar}}" mode="aspectFill" binderror="onAvatarError"></image>
      <view class="user-name-time">
        <view class="nickname">{{formattedComment.nickname || '匿名用户'}}</view>
        <view class="time">{{formattedComment.create_time_formatted}}</view>
      </view>
    </view>
    
    <view class="actions">
      <!-- 回复按钮 -->
      <button 
        class="action-button"
        icon="{{ {name: 'comment', size: 28, color: '#999'} }}"
        bind:tap="onTapReply"
      ></button>
      
      <!-- 点赞按钮 -->
      <button
        class="action-button"
        icon="{{ {name: formattedComment.isLiked ? 'like-active' : 'like', size: 28, color: formattedComment.isLiked ? '#ff6b6b' : '#999'} }}"
        showCount="{{true}}"
        count="{{formattedComment.like_count || 0}}"
        hideZero="{{true}}"
        bind:tap="onTapLike"
      ></button>
      
      <!-- 删除按钮，仅评论作者可见 -->
      <button
        wx:if="{{formattedComment.isOwner}}"
        class="action-button delete-button"
        icon="{{ {name: 'delete', size: 28, color: '#ff4d4f'} }}"
        bind:tap="onTapDelete"
      ></button>
    </view>
  </view>
  
  <view class="comment-content">
    <!-- 评论回复对象 -->
    <view class="reply-to" wx:if="{{formattedComment.reply_to}}">
      回复 <text class="reply-name">@{{formattedComment.reply_to.nickname || '匿名用户'}}</text>:
    </view>
    
    <!-- 评论内容 -->
    <view class="content-text">{{formattedComment.content}}</view>
    
    <!-- 评论图片 -->
    <view class="content-images" wx:if="{{formattedComment.image && formattedComment.image.length > 0}}">
      <view 
        class="content-image" 
        wx:for="{{formattedComment.image}}" 
        wx:key="*this" 
        bindtap="onPreviewImage"
        data-current="{{item}}"
      >
        <image src="{{item}}" mode="aspectFill" binderror="onImageError"></image>
      </view>
    </view>
  </view>
  
  <!-- 子评论区域 -->
  <view class="replies" wx:if="{{formattedComment.replies && formattedComment.replies.length > 0}}">
    <block wx:for="{{formattedComment.replies}}" wx:key="id">
      <comment-item 
        comment="{{item}}" 
        openid="{{openid}}"
        bind:like="handleChildLike"
        bind:reply="handleChildReply"
        bind:delete="handleChildDelete"
      ></comment-item>
    </block>
  </view>
</view> 